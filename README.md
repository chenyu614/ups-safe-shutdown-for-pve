这里的target_ip是我要ping的路由IP。注意shutdown命令这里使用了绝对路径，为什么会这么做稍后会讲到。
开机启动脚本
脚本编写完成后，我们需要在开机的时候自动运行它。我是将脚本放在/usr/local/bin目录下，注意脚本编写完成后要使用chmod +x来使得脚本可执行。一开始我采用的开机启动脚本的方法是在/etc/rc.local写入脚本路径，一开始运行良好，但某一天突然就失效了，所以后来换了第二种方法，
具体如下：首先使用crontab -e（非root下要使用sudo crontab -e），在其中写入@reboot /usr/local/bin/ups-safe-shutdown.sh &。这样每次开机时就会启动这个脚本了。但随之而来有一个问题，由于crontab的一些限制（或者说特性），直接在脚本中执行shutdown是不会关机的，所以关机命令要使用绝对路径。
结语
至此，PVE主机就可以在停电的时候安全地自动关机了。至于来电后的开机，我采用的是远程开机的方法，大多数主板基本上都是支持的。需要稍微配置一下，来让PVE系统支持这个功能。新建一个脚本wake-on-lan.sh，具体如下：
bash复制代码#!/bin/sh
/sbin/ethtool -s enp1s0 wol g


注：enp1s0这个名称在PVE面板中系统->网络中可以找到

由于每次开机都需要配置这个命令，最后我们也要使用crontab来配置一下这个脚本。

作者：ryougifujino
链接：https://juejin.cn/post/6874098313839575047
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
